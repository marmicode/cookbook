---
draft: true
slug: /nx/set-up-nx
---

# ðŸš§ Set up Nx

## Creating an Nx Workspace

If you are fortunate enough to start a new project from scratch, then you can simply generate a new Nx workspace using the following command:

import NpmCommand from '@site/src/components/npm-command';

<NpmCommand args="create nx-workspace@latest <name> --preset <preset>" />

where `preset` is one of the following depending on your needs:

- `apps`: creates an empty workspace.
- `ts`: creates an empty workspace with TypeScript support.
- `angular|expo|express|nest|next|nuxt|react|react-native|vue`: creates a workspace with a single application using the framework of your choice.

:::warning
There is also the `npm` preset but we only recommend it if you **really** know what you are doing.

<details>
  <summary>Tell me more</summary>
  <div>
The `npm` preset creates an empty workspace with two main differences _(in order to align with the behavior of [Lerna](https://lerna.js.org/))_:

- the package manager is configured to install the dependencies described in each project's `package.json` (Cf. [PNPM Workspaces](https://pnpm.io/workspaces), [NPM Workspaces](https://docs.npmjs.com/cli/v8/using-npm/workspaces), [Yarn Workspaces](https://yarnpkg.com/features/workspaces)) which means that [Single Version Policy](../06-glossary.md#single-version-policy) will not be enforced.
- [`analyzeSourceFiles` option](https://nx.dev/recipes/tips-n-tricks/analyze-source-files) is set to `false` which means that Nx will not analyze the dependency graph between projects. This also means that Nx will not warn us if we forgot a dependency in a project's `package.json` _(Cf. [Dependency Checks Rule](https://nx.dev/nx-api/eslint-plugin/documents/dependency-checks))_.

Note that these two behaviors can be controlled separately.

Curious about NPM workspaces along with Nx?
Check out [Analog](https://github.com/analogjs/analog) & [RxJS](https://github.com/ReactiveX/rxjs) repositories.
Note that `analyzeSourceFiles` is set to `true` in both repositories.

</div>
</details>
:::

:::note
The exhaustive list of built-in presets is available here: [https://nx.dev/nx-api/nx/documents/create-nx-workspace#preset](https://nx.dev/nx-api/nx/documents/create-nx-workspace#preset).
:::

## Install Nx Globally

While this is optional, it is helpful to install Nx globally:

<NpmCommand
  args={{
    npm: 'install -g nx@latest',
    pnpm: 'add -g nx@latest',
    yarn: 'global add nx@latest',
  }}
/>

:::note
Note that the global `nx` command will always use the workspace's version of Nx.

You don't have to worry about version mismatch.
:::

## Standalone vs. Integrated

With most presets, you will be asked to choose between a **Standalone** or an **Integrated Monorepo** workspace.

```sh
> Integrated monorepo, or standalone project? â€¦
Integrated Monorepo:  Nx creates a monorepo that contains multiple projects.
Standalone:           Nx creates a single project and makes it fast.
```

**Standalone** mode will create an application at the **root of the workspace**. The file structure would look something like this:

```
â”œâ”€â”€ README.md
â”œâ”€â”€ index.html
â”œâ”€â”€ nx.json
â”œâ”€â”€ package.json
â”œâ”€â”€ project.json
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ app
â”‚   â”‚   â”œâ”€â”€ app.spec.ts
â”‚   â”‚   â””â”€â”€ app.ts
â”‚   â””â”€â”€ main.ts
â”œâ”€â”€ tsconfig.app.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.spec.json
â””â”€â”€ vite.config.ts
```

It will also add scripts like `build`, `start`, and `test` to the `package.json` file.

**Integrated Monorepo** mode will create the application in the `apps` folder and create a `tsconfig.base.json` that all projects will extend from. The file structure would look something like this:

```
â”œâ”€â”€ README.md
â”œâ”€â”€ apps               ðŸ‘ˆ
â”‚  â””â”€â”€ marmicode       ðŸ‘ˆ
â”‚      â”œâ”€â”€ index.html
â”‚      â”œâ”€â”€ project.json
â”‚      â”œâ”€â”€ src
â”‚      â”‚  â”œâ”€â”€ app
â”‚      â”‚  â”‚  â”œâ”€â”€ app.spec.ts
â”‚      â”‚  â”‚  â”œâ”€â”€ app.ts
â”‚      â”‚  â””â”€â”€ main.ts
â”‚      â”œâ”€â”€ tsconfig.app.json
â”‚      â”œâ”€â”€ tsconfig.json
â”‚      â”œâ”€â”€ tsconfig.spec.json
â”‚      â””â”€â”€ vite.config.ts
â”œâ”€â”€ nx.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.base.json ðŸ‘ˆ
```

:::note
Note that you can always switch from **Standalone** to **Integrated Monorepo** later on by moving the application to the `apps` folder using the `@nx/workspace:move` generator.

```sh
nx g @nx/workspace:move --projectName <name> --destination apps/<name>
```

_Make sure to add `@nx/workspace` to your `devDependencies`:_

<NpmCommand args={'add -D @nx/workspace'} />
:::

:::tip
Prefer **Integrated Monorepo** mode over **Standalone**.

In our experience, **Standalone** workspaces eventually end up being migrated to **Integrated Monorepo**.

In addition to this, note that even though it is possible to move the application using `@nx/workspace:move` generator later on, the process is not magic and might miss some things like files added after the initial creation. _(e.g. docs, test setup files, etc...)_
:::

## Migrating to Nx

If you are migrating an existing project to Nx, you have two options:

- [Add Nx to an existing workspace](#add-nx-to-an-existing-workspace).
- [Create a new Nx workspace and move existing code into it](#move-existing-code-into-a-new-nx-workspace).

### Add Nx to an Existing Workspace

Given an existing repository, we can add Nx to it using the following command:

```sh
nx init --integrated
```

_Note that the `--integrated` option will only work on Angular CLI workspaces and Create React App (CRA) projects._

While this command works pretty well in most common cases, it is not perfect because:

- it will generally reuse existing npm scripts (e.g. `build`, `start`, `test`, etc...) which might not be optimal compared to what Nx executors can offer,
- it will prompt you to choose which of these scripts are cacheable and what are their outputs, but it will not ask about their inputs which we would have to configure later on in the `nx.json` file,
- the final result will not be exactly aligned with an Nx workspace created from scratch.

:::tip
We recommend [creating a new Nx workspace and moving existing code into it](#move-existing-code-into-a-new-nx-workspace).
:::

### Move existing code into a new Nx workspace

TODO:

- create a new Nx workspace
- `git merge --allow-unrelated-histories`
- fix conflicts (mob programming)
- move source code in to `apps/<name>`
- use `run-commands` executor when nx executors are not available or not compatible with existing configs
